kind: ConfigMap
apiVersion: v1
metadata:
  annotations:
    argocd.argoproj.io/sync-wave: "2"
  name: app-config-rhdh
data:
  app-config-rhdh.yaml: |
    app:
      title: Home Lab IDP
      baseUrl: https://backstage-developer-hub-rhdh.apps.lab.pitt.ca
      
    auth:
      providers:
        guest:
          dangerouslyAllowOutsideDevelopment: true

    azureDevOps:
      host: dev.azure.com
      token: ${PERSONAL_ACCESS_TOKEN}
      organization: pittar-demos

    integrations:
      azure:
        - host: dev.azure.com
          credentials:
            - personalAccessToken: ${PERSONAL_ACCESS_TOKEN}

    catalog:
      rules:
        - allow: [Component, System, Group, Resource, Location, Template, API]
      locations:
        - type: url
          target: https://dev.azure.com/pittar-demos/rhdh-demo/_git/software-templates?path=/showcase-templates.yaml

    # auth:
    #   environment: production
    #   session:
    #     secret: ${BACKEND_AUTH_SECRET}
    #   providers:
    #     oidc:
    #       production:
    #         metadataUrl: ${KEYCLOAK_BASE_URL}/realms/${KEYCLOAK_REALM} #${AUTH_OIDC_METADATA_URL}
    #         clientId: ${KEYCLOAK_CLIENTID}
    #         clientSecret: ${KEYCLOAK_CLIENTSECRET}
    #         prompt: ${AUTH_OIDC_PROMPT} 
    #         signIn:
    #           resolvers:
    #             - resolver: preferredUsernameMatchingUserEntityName
    # signInPage: oidc

    # catalog:
    #  providers:
    #    keycloakOrg:
    #      production:
    #        baseUrl: ${KEYCLOAK_BASE_URL}
    #        loginRealm: ${KEYCLOAK_REALM}
    #        realm: ${KEYCLOAK_REALM}
    #        clientId: ${KEYCLOAK_CLIENTID}
    #        clientSecret: ${KEYCLOAK_CLIENTSECRET}
    #        schedule:
    #         frequency: { minutes: 1 }
    #         timeout: { minutes: 1 }
    #         initialDelay: { seconds: 15 }


    backend:
      # auth:
      #   keys:
      #     - secret: ${BACKEND_AUTH_SECRET}
      baseUrl: https://backstage-developer-hub-rhdh.apps.lab.pitt.ca
      cors:
        origin: https://backstage-developer-hub-rhdh.apps.lab.pitt.ca
